---
import Logo from "@components/base/Logo.astro";
import ButtonMain from "@components/base/ButtonMain.astro";
import Hamburger from "@components/base/Hamburger.astro";
import LanguageToggle from "@components/base/LanguageToggle.astro";
import { getRelativeLocaleUrl } from 'astro:i18n';
import { t, getCurrentLocale } from "@utils/i18n";

// Check if current page has dark hero
const currentPath = Astro.url.pathname;

// Check for dark hero pages (products, about, contact) in any locale
const isDarkHeroPage = currentPath.includes('/products') || 
                       currentPath.includes('/about') || 
                       currentPath.includes('/contact');

// Detect current locale
const currentLocale = getCurrentLocale(Astro.url);

// Generate localized URLs
const homeUrl = getRelativeLocaleUrl(currentLocale, '/');
const productsUrl = getRelativeLocaleUrl(currentLocale, '/products');
const aboutUrl = getRelativeLocaleUrl(currentLocale, '/about');
const contactUrl = getRelativeLocaleUrl(currentLocale, '/contact');
---

<!-- Top Contact Bar -->
<div class="fixed top-0 left-0 w-full z-50 bg-primary-600 text-white py-1 text-sm">
  <div class="w-full max-w-7xl mx-auto px-4 flex items-center justify-between">
    <div class="flex items-center gap-6">
      <a href="mailto:mfgsonamoorubbertech@gmail.com" class="flex items-center gap-2 hover:text-primary-200 transition-colors duration-300">
        <iconify-icon class="w-3 h-3" icon="lucide:mail"></iconify-icon>
        <span class="hidden sm:inline text-xs">mfgsonamoorubbertech@gmail.com</span>
      </a>
      <a href="tel:+6282138278015" class="flex items-center gap-2 hover:text-primary-200 transition-colors duration-300">
        <iconify-icon class="w-3 h-3" icon="lucide:phone"></iconify-icon>
        <span class="hidden sm:inline text-xs">+62 821-3827-8015</span>
      </a>
    </div>
    <div class="flex items-center gap-2">
      <iconify-icon class="w-3 h-3 text-primary-200" icon="lucide:map-pin"></iconify-icon>
      <span class="hidden sm:inline text-primary-200 text-xs">Tenjo, Bogor, Indonesia</span>
    </div>
  </div>
</div>

<div
  x-cloak
  x-data="navbar()"
  x-on:scroll.window="scroll()"
  class="fixed top-[20px] md:top-6 left-0 w-full z-40 transition-all duration-300"
  :class="scrolled || $store.app.mobileOpen ? 'bg-white shadow-lg shadow-muted-300/30' : ''"
>
  <div
    class="w-full max-w-7xl mx-auto flex items-center justify-between pl-4 pr-0 lg:pr-4 font-sans"
  >
    <!-- Left -->
    <div class="w-full lg:w-auto flex items-center gap-6">
      <a href={homeUrl} class="flex items-center gap-3">
        <div>
          <Logo class="'w-9 h-9'" />
        </div>
        <span
          class={`font-sans text-4xl font-black transition-colors duration-300 ${
            isDarkHeroPage 
              ? 'text-white [&.scrolled]:text-primary-700' 
              : 'text-primary-700'
          }`}
          x-bind:class="scrolled ? 'scrolled' : ''"
          >SRT</span>
      </a>
      <div class="flex items-center justify-center h-20 w-20 lg:hidden ml-auto">
        <Hamburger />
      </div>
    </div>
    <!-- Right -->
    <div
      class="flex-col items-center lg:justify-end gap-x-6"
      :class="$store.app.mobileOpen ? 'absolute top-[80px] left-0 w-full flex text-center px-6 pt-2 pb-6 border-t border-muted-200 bg-white shadow-lg shadow-muted-300/40' : 'hidden lg:flex lg:flex-row'"
    >
      <div class="flex flex-col lg:flex-row items-center gap-x-6 lg:gap-x-10">
        <div class={`relative py-3 lg:py-5 after:content-[''] after:absolute after:-bottom-1.5 after:left-0 after:h-[3px] after:rounded-t-full after:transition-all after:duration-300 transition-colors duration-300 ${
          isDarkHeroPage 
            ? 'text-white/90 hover:text-white [&.scrolled]:text-slate-500 [&.scrolled]:hover:text-muted-700 after:w-0' 
            : 'text-slate-500 hover:text-muted-700 after:w-0'
        }`}
          x-bind:class="scrolled ? 'scrolled' : ''"
        >
          <a href={homeUrl}>{t(currentLocale, 'nav.home')}</a>
        </div>
        <div class={`relative py-3 lg:py-5 after:content-[''] after:absolute after:-bottom-1.5 after:left-0 after:h-[3px] after:rounded-t-full after:transition-all after:duration-300 transition-colors duration-300 ${
          isDarkHeroPage 
            ? 'text-white/90 hover:text-white [&.scrolled]:text-slate-500 [&.scrolled]:hover:text-muted-700 after:w-0' 
            : 'text-slate-500 hover:text-muted-700 after:w-0'
        }`}
          x-bind:class="scrolled ? 'scrolled' : ''"
        >
          <a href={productsUrl}>{t(currentLocale, 'nav.products')}</a>
        </div>
        <div class={`relative py-3 lg:py-5 transition-colors duration-300 ${
          isDarkHeroPage 
            ? 'text-white/90 hover:text-white [&.scrolled]:text-slate-500 [&.scrolled]:hover:text-muted-700' 
            : 'text-slate-500 hover:text-muted-700'
        }`}
          x-bind:class="scrolled ? 'scrolled' : ''"
        >
          <a href={aboutUrl}>{t(currentLocale, 'nav.about')}</a>
        </div>
      </div>
      <div class="flex flex-col lg:flex-row items-center gap-4 w-full md:w-auto">
        <div class="order-2 lg:order-1">
          <LanguageToggle />
        </div>
        <div class="order-1 lg:order-2 w-full md:w-auto">
          <ButtonMain to={contactUrl} class="'w-full md:w-[240px] lg:w-[110px]'"
            >{t(currentLocale, 'nav.contact_us')}</ButtonMain
          >
        </div>
      </div>
    </div>
  </div>
</div>